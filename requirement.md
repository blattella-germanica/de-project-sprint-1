# Витрина RFM

## Цель
Необходимо построить витрину данных для RFM-классификации пользователей приложения.
Заказчик - компания, разрабатывающая приложение по доставке еды.

## Основные требования к витрине

- Исходные данные: оперативные таблицы в схеме production БД de;
- Витрина должна располагаться в схеме analysis БД de;
- Название витрины должно быть dm_rfm_segments;
- Витрина должна состоять из следующих полей:
	- user_id
	- recency (число от 1 до 5)
	- frequency (число от 1 до 5)
	- monetary_value (число от 1 до 5)
- Данные в витрине за 2022г;
- Обновления не нужны;
- Для анализа нужно отобрать только успешные заказы (статус "Closed");
- Требования к RFM-сегментации: присвойте каждому клиенту три значения (Recency, Frequency, Monetary Value):
Фактор *Recency* измеряется по последнему заказу. Распределите клиентов по шкале от одного до пяти, где значение 1 получат те,
кто либо вообще не делал заказов, либо делал их очень давно, а 5 — те, кто заказывал относительно недавно.
Фактор *Frequency* оценивается по количеству заказов. Распределите клиентов по шкале от одного до пяти,
где значение 1 получат клиенты с наименьшим количеством заказов, а 5 — с наибольшим.
Фактор *Monetary Value* оценивается по потраченной сумме. Распределите клиентов по шкале от одного до пяти,
где значение 1 получат клиенты с наименьшей суммой, а 5 — с наибольшей.
Количество клиентов в каждом сегменте должно быть одинаково. 


## Cтруктура исходных данных

Схема production  БД de состоит из 6 таблиц: orderitems, orders, orderstatuses, orderstatuslog, products и users.
Для создания витрины нам необходимы следующие таблицы:
- orders:
	- user_id
	- order_id - для рассчета количества заказов для каждого клиента, чтобы впоследствии рассчитать Frequency;
	- order_ts - время заказа для вычисления Recency и ограничении по дате (только 2022г);
	- cost - сумма заказа для расчета общей суммы заказов по каждому клиенту для вычисления Monetary Value;
	- status - код статуса заказа, значение которого можно посмотреть в таблице orderstatuses.

